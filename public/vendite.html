<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Vendita | Edicola</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
      margin: 0;
      padding: 0;
    }

    .top-bar {
      background-color: #4f46e5;
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 20px;
    }

    .top-bar h1 {
      margin: 0;
      font-size: 20px;
    }

    .home-btn {
      background-color: white;
      color: #4f46e5;
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease;
    }

    .home-btn:hover {
      background-color: #e0e7ff;
    }

    .container {
      max-width: 900px;
      margin: 30px auto;
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
      text-align: center;
    }

    th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 14px;
    }

    input[readonly] {
      background-color: #f3f4f6;
    }

    .confirm-btn {
      background-color: #4f46e5;
      color: white;
      border: none;
      padding: 14px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }

    .confirm-btn:hover {
      background-color: #4338ca;
    }

    #messaggio {
      margin-top: 20px;
      font-size: 15px;
      color: #d32f2f;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <a href="/gestionale.html" class="home-btn">üè† Home</a>
    <h1>üí∞ Vendita</h1>
  </div>

  <div class="container">
    <table id="tabellaProdotti">
      <thead>
        <tr>
          <th>Codice</th>
          <th>Nome</th>
          <th>Prezzo (‚Ç¨)</th>
          <th>Quantit√†</th>
          <th>Totale (‚Ç¨)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" oninput="riconosciProdotto(this)"></td>
          <td><input type="text" readonly></td>
          <td><input type="number" readonly></td>
          <td><input type="number" min="1" value="1" oninput="calcolaTotale(this)"></td>
          <td><input type="text" readonly></td>
        </tr>
      </tbody>
    </table>

    <button class="confirm-btn" onclick="aggiungiRiga()">‚ûï Aggiungi Prodotto</button>
    <button class="confirm-btn" onclick="confermaVendita()">‚úî Conferma Vendita</button>
    <p id="messaggio"></p>
  </div>

  <script>
    const prodotti = {
      '123456': { nome: 'Giornale Sportivo', prezzo: 2.50 },
      '789012': { nome: 'Rivista Moda', prezzo: 3.20 },
      '345678': { nome: 'Album Figurine', prezzo: 5.00 }
    };

    function riconosciProdotto(input) {
      const codice = input.value;
      const riga = input.parentElement.parentElement;
      const prodotto = prodotti[codice];

      if (prodotto) {
        riga.cells[1].querySelector('input').value = prodotto.nome;
        riga.cells[2].querySelector('input').value = prodotto.prezzo;
        calcolaTotale(riga.cells[3].querySelector('input'));
      } else {
        riga.cells[1].querySelector('input').value = '';
        riga.cells[2].querySelector('input').value = '';
        riga.cells[4].querySelector('input').value = '';
      }
    }

    function calcolaTotale(input) {
      const riga = input.parentElement.parentElement;
      const prezzo = parseFloat(riga.cells[2].querySelector('input').value);
      const quantita = parseInt(input.value);
      if (!isNaN(prezzo) && !isNaN(quantita)) {
        const totale = (prezzo * quantita).toFixed(2);
        riga.cells[4].querySelector('input').value = totale;
      }
    }

    function aggiungiRiga() {
      const tbody = document.querySelector('#tabellaProdotti tbody');
      const nuovaRiga = document.createElement('tr');
      nuovaRiga.innerHTML = `
        <td><input type="text" oninput="riconosciProdotto(this)"></td>
        <td><input type="text" readonly></td>
        <td><input type="number" readonly></td>
        <td><input type="number" min="1" value="1" oninput="calcolaTotale(this)"></td>
        <td><input type="text" readonly></td>
      `;
      tbody.appendChild(nuovaRiga);
    }

    function confermaVendita() {
      const righe = document.querySelectorAll('#tabellaProdotti tbody tr');
      let totaleVendita = 0;
      let prodottiValidi = 0;

      righe.forEach(riga => {
        const nome = riga.cells[1].querySelector('input').value;
        const totale = parseFloat(riga.cells[4].querySelector('input').value);
        if (nome && !isNaN(totale)) {
          totaleVendita += totale;
          prodottiValidi++;
        }
      });

      if (prodottiValidi === 0) {
        document.getElementById('messaggio').textContent = '‚ö†Ô∏è Inserisci almeno un prodotto valido.';
      } else {
        document.getElementById('messaggio').textContent = `‚úÖ Vendita confermata. Totale: ‚Ç¨${totaleVendita.toFixed(2)}`;
        // Qui puoi inviare i dati al backend
      }
    }
  </script>
</body>
</html>